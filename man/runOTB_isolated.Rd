% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/parseOTB.R
\name{runOTB_isolated}
\alias{runOTB_isolated}
\title{Run Orfeo Toolbox applications in an isolated environment session}
\usage{
runOTB_isolated(
  otbCmdList = NULL,
  gili = NULL,
  retRaster = TRUE,
  retCommand = FALSE,
  quiet = TRUE
)
}
\arguments{
\item{otbCmdList}{Named list of OTB parameters (as used by [runOTB()]).
Must not be `NULL`. Typical keys include `in`, `out`, `io.out`, `out.xml`,
and algorithm-specific parameters.}

\item{gili}{Optional list returned by [linkOTB()]. If `NULL`, [linkOTB()] is
called internally.}

\item{retRaster}{Logical; if `TRUE` (default) and an output file path can be
inferred, reads the produced output back into R (raster/XML/vector as
appropriate).}

\item{retCommand}{Logical; if `TRUE`, returns only the command string built by
[runOTB()] and does not execute anything.}

\item{quiet}{Logical; if `TRUE` (default), suppress stdout/stderr from the
system call. Set to `FALSE` for debugging.}
}
\value{
If `retCommand = TRUE`, a character string containing the command line.

Otherwise returns one of:
- A `terra::SpatRaster` if the inferred output is `tif/tiff/vrt` and
  `retRaster = TRUE`.
- An `xml2::xml_document` if the inferred output is `xml` and
  `retRaster = TRUE`.
- An `sf` object if `otbCmdList$mode == "vector"` and `retRaster = TRUE`.
- Otherwise, returns the (invisible) result from the underlying `system2()`
  call (typically exit status / captured output depending on platform).
}
\description{
Executes an OTB command while ensuring that the OTB runtime environment is
initialized **in the same shell session** as the application call.
}
\details{
This is mainly needed for **OTB standalone bundles** where the environment
must be activated via an `otbenv` script:
- **Windows OTB >= 9.x**: `otbenv.ps1` must be **dot-sourced** in PowerShell
  in the same session as the call.
- **Windows legacy**: `otbenv.bat` / `otbenv.cmd` can be chained in `cmd.exe`.
- **Linux/macOS**: `otbenv.profile` is sourced in a `bash -lc` session.

The function uses [runOTB()] to build a printable command line (with
`retCommand = TRUE`) but executes it in a separate, isolated process with the
correct environment initialization.


Output path inference checks, in order: `out.xml`, `out`, then `io.out`.
If the output does not exist after execution, the function errors.

Note: This function assumes that `gili$envScript` points to a valid
environment initializer: `otbenv.profile` (Linux/macOS) or
`otbenv.ps1`/`otbenv.bat` (Windows).
}
\examples{
\dontrun{
library(link2GI)

otb <- linkOTB()
cmd <- list(
  in  = "input.tif",
  out = "pca.tif",
  method = "pca",
  nbcomp = "3"
)

# Print the command only
runOTB_isolated(cmd, otb, retCommand = TRUE)

# Execute and read output raster
r <- runOTB_isolated(cmd, otb, retRaster = TRUE, quiet = FALSE)
}

}
